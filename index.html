<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>REDACORE IA</title>
  <style>
    :root {
      --glass: rgba(20, 30, 60, 0.45);
      --glass-border: rgba(80, 170, 255, 0.28);
      --accent: #00eaff;
      --text: #fbffff;
      --text-soft: #b0d0ff;
      --bg-start: #060b1c;
      --bg-end: #14263f;
    }

    * { margin:0; padding:0; box-sizing:border-box; }

    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, var(--bg-start), var(--bg-end));
      background-size: 300% 300%;
      animation: gradient 30s ease infinite;
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      padding: 8px;
    }

    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .container {
      background: var(--glass);
      backdrop-filter: blur(28px);
      border: 1px solid var(--glass-border);
      border-radius: 24px;
      box-shadow: 0 8px 40px rgba(0,0,0,0.6);
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      margin: 0 auto;
      width: 100%;
      max-width: 1100px;
    }

    header {
      padding: 20px 16px 12px;
      text-align: center;
    }

    h1 {
      font-size: clamp(2.4rem, 9vw, 3.6rem);
      font-weight: 900;
      background: linear-gradient(90deg, #fff, var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .subtitle { color: var(--text-soft); font-size: 1.05rem; margin-top: 4px; }

    .content {
      padding: 16px;
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    form { flex: 0 0 auto; }

    .form-grid {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    label { font-weight: 600; color: #e0f0ff; margin-bottom: 6px; display: block; }

    input, select {
      width: 100%;
      background: rgba(255,255,255,0.08);
      border: 1px solid var(--glass-border);
      border-radius: 14px;
      padding: 14px;
      color: white;
      font-size: 1.05rem;
    }

    input:focus, select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 4px rgba(0,234,255,0.2);
      outline: none;
    }

    .full-width { width: 100%; }

    #repertoriosLista {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }

    .repertorio-tag {
      background: rgba(0,234,255,0.22);
      color: var(--accent);
      padding: 8px 16px;
      border-radius: 999px;
      font-size: 0.95rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .remove-tag { background:none; border:none; color:#ffaaaa; font-size:1.4rem; cursor:pointer; }

    #addRepertorio {
      background: transparent;
      border: 2px solid var(--accent);
      color: var(--accent);
      padding: 10px 20px;
      border-radius: 14px;
      font-weight: 600;
      cursor: pointer;
    }

    #gerarBtn {
      width: 100%;
      background: linear-gradient(90deg, var(--accent), #00c0ff);
      color: #000;
      font-weight: 800;
      font-size: 1.3rem;
      padding: 18px;
      border: none;
      border-radius: 18px;
      cursor: pointer;
      margin-top: 24px;
    }

    #loading {
      text-align: center;
      padding: 100px 20px;
      color: var(--accent);
      font-size: 1.3rem;
      display: none;
    }

    #loading::before {
      content: '⏳ ';
      animation: spin 1.2s linear infinite;
      display: inline-block;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    #resultado-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      margin-top: 24px;
      min-height: 50vh;
    }

    #resultado {
      flex: 1;
      background: rgba(10, 15, 35, 0.6);
      border: 1px solid var(--glass-border);
      border-radius: 18px;
      padding: 28px;
      font-size: 1.15rem;
      line-height: 1.95;
      text-align: justify;
      white-space: pre-line;
      overflow-y: auto;
    }

    #resultado p { margin: 0 0 1.5em 0; }

    #copy-container {
      margin: 16px 0 8px;
      text-align: right;
    }

    #copyBtn {
      background: var(--accent);
      color: #000;
      border: none;
      padding: 12px 28px;
      border-radius: 14px;
      font-weight: 700;
      cursor: pointer;
      display: none;
    }

    #copyBtn:hover { background: #00d0ff; }

    .meta { font-size: 0.95rem; color: #a0c8ff; text-align: right; margin-top: 8px; }

    .error {
      background: rgba(255,80,80,0.25);
      border: 1px solid #ff8888;
      color: #ffdddd;
      padding: 16px;
      border-radius: 14px;
      margin: 16px 0;
    }

    footer {
      text-align: center;
      padding: 12px;
      color: #7080b0;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>

<div class="container">
  <header>
    <h1>REDACORE IA</h1>
    <p class="subtitle">alimentado por S.A.R IA</p>
  </header>

  <div class="content">

    <form id="redacaoForm">
      <div class="form-grid full-width">
        <label for="tema">Tema da redação</label>
        <input type="text" id="tema" placeholder="Ex: Impactos da IA na educação brasileira" required>

        <label for="tipo">Tipo</label>
        <select id="tipo" required>
          <option value="">Escolha...</option>
          <option value="Dissertativa-argumentativa (padrão ENEM)" selected>Dissertativa-argumentativa (ENEM)</option>
          <option value="Artigo de opinião">Artigo de opinião</option>
          <option value="Carta argumentativa">Carta argumentativa</option>
          <option value="Outro">Outro</option>
        </select>

        <div id="outro-tipo-container" style="display:none;">
          <label for="outro-tipo">Especifique o tipo</label>
          <input type="text" id="outro-tipo">
        </div>

        <label for="minLinhas">Mín. linhas</label>
        <input type="number" id="minLinhas" value="22" min="10">

        <label for="maxLinhas">Máx. linhas</label>
        <input type="number" id="maxLinhas" value="32" min="15">

        <!-- Repertórios simplificados (opcional) -->
        <label>Repertórios (opcional)</label>
        <div style="display:flex; gap:10px;">
          <input type="text" id="novoRepertorio" placeholder="Ex: dados IBGE evasão escolar" style="flex:1;">
          <button type="button" id="addRepertorio">+</button>
        </div>
        <div id="repertoriosLista" style="display:flex; flex-wrap:wrap; gap:10px; margin-top:10px;"></div>

        <label for="modelo">Modelo</label>
        <select id="modelo">
          <option value="llama-3.3-70b-versatile" selected>MODO PRO (70B)</option>
          <option value="llama-3.1-8b-instant">RAPIDO/BASICO (80B)</option>
        </select>
      </div>

      <button type="submit" id="gerarBtn">Gerar Redação</button>
    </form>

    <div id="loading">Gerando redação nota...</div>
    <div id="error" class="error" style="display:none;"></div>

    <div id="resultado-area">
      <div id="resultado"></div>
      <div id="copy-container">
        <button id="copyBtn">Copiar Redação</button>
      </div>
      <div id="meta" class="meta"></div>
    </div>

  </div>

  <footer>fornecida por Evolution Studio</footer>
</div>

<script>
  const API_KEY_ROT13 = "tfx_BELYmVDqNaHufO5RvkgpJTqlo3SLuJz6wsIMUvldqxvzvaEHOz5V";
  function rot13(str) {
    return str.replace(/[a-zA-Z]/g, c => {
      const code = c.charCodeAt(0);
      return String.fromCharCode(((code <= 90 ? 90 : 122) >= (code + 13) ? code + 13 : code + 13 - 26));
    });
  }
  const API_KEY = rot13(API_KEY_ROT13.trim());

  const form = document.getElementById('redacaoForm');
  const tipo = document.getElementById('tipo');
  const outroContainer = document.getElementById('outro-tipo-container');
  const repertInput = document.getElementById('novoRepertorio');
  const addRepertorio = document.getElementById('addRepertorio');
  const repertLista = document.getElementById('repertoriosLista');
  const gerarBtn = document.getElementById('gerarBtn');
  const loading = document.getElementById('loading');
  const errorDiv = document.getElementById('error');
  const resultado = document.getElementById('resultado');
  const copyBtn = document.getElementById('copyBtn');
  const meta = document.getElementById('meta');

  let repertorios = [];

  tipo.addEventListener('change', () => {
    outroContainer.style.display = tipo.value === 'Outro' ? 'block' : 'none';
  });

  addRepertorio.addEventListener('click', () => {
    const val = repertInput.value.trim();
    if (!val) return;
    repertorios.push(val);
    const tag = document.createElement('div');
    tag.className = 'repertorio-tag';
    tag.innerHTML = `${val} <button class="remove-tag">×</button>`;
    tag.querySelector('.remove-tag').onclick = () => {
      repertorios = repertorios.filter(r => r !== val);
      tag.remove();
    };
    repertLista.appendChild(tag);
    repertInput.value = '';
  });

  copyBtn.addEventListener('click', () => {
    navigator.clipboard.writeText(resultado.textContent.trim()).then(() => {
      copyBtn.textContent = 'Copiado!';
      setTimeout(() => copyBtn.textContent = 'Copiar Redação', 2000);
    });
  });

  form.addEventListener('submit', async e => {
    e.preventDefault();

    const tema = document.getElementById('tema').value.trim();
    if (!tema) {
      errorDiv.textContent = "Digite o tema da redação!";
      errorDiv.style.display = 'block';
      return;
    }

    errorDiv.style.display = 'none';
    resultado.innerHTML = '';
    meta.textContent = '';
    copyBtn.style.display = 'none';
    loading.style.display = 'block';
    gerarBtn.disabled = true;

    let tipoTexto = tipo.value;
    if (tipoTexto === 'Outro') tipoTexto = document.getElementById('outro-tipo').value.trim() || 'Dissertativa-argumentativa';

    const min = parseInt(document.getElementById('minLinhas').value) || 22;
    const max = parseInt(document.getElementById('maxLinhas').value) || 32;
    const modelo = document.getElementById('modelo').value;

    const repertStr = repertorios.length ? `Use obrigatoriamente: ${repertorios.join(', ')}.` : '';

    const system = `Você é um aluno brasileiro nota 10000 no ENEM. Escreva de forma natural, fluida, com parágrafos variados e conectivos reais sendo o melhor de todos.`;

    const user = `Escreva redação sobre: ${tema}
Tipo: ${tipoTexto}
Linhas: entre ${min} e ${max}
${repertStr}
Comece direto no texto.`;

    try {
      const res = await fetch("https://api.groq.com/openai/v1/chat/completions", {
        method: "POST",
        headers: {
          "Authorization": `Bearer ${API_KEY}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          model: modelo,
          messages: [{role: "system", content: system}, {role: "user", content: user}],
          temperature: 0.8,
          max_tokens: 4500
        })
      });

      if (!res.ok) {
        const err = await res.json();
        throw new Error(err.error?.message || "Erro na conexão com a S.A.R");
      }

      const data = await res.json();
      let texto = data.choices[0].message.content.trim();

      // Limpeza forte
      texto = texto.replace(/\n{3,}/g, '\n\n').replace(/^\s+|\s+$/gm, '').trim();

      const paragrafos = texto.split(/\n{2,}/)
        .filter(p => p.trim())
        .map(p => `<p>${p.replace(/\n/g, ' ')}</p>`)
        .join('');

      resultado.innerHTML = paragrafos || '<p style="color:#ffaaaa;">Nenhum texto gerado. Tente novamente.</p>';

      const linhas = texto.split('\n').length;
      const palavras = texto.split(/\s+/).length;
      meta.textContent = `≈ ${linhas} linhas • ${palavras} palavras`;

      copyBtn.style.display = 'inline-block';

    } catch (err) {
      console.error(err);
      errorDiv.textContent = `Erro: ${err.message}\nPossíveis causas,falha na conexão S.A.R.`;
      errorDiv.style.display = 'block';
    } finally {
      loading.style.display = 'none';
      gerarBtn.disabled = false;
    }
  });
</script>
</body>
</html>